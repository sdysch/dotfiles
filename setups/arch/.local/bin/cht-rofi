#!/usr/bin/env bash

ROFI='rofi -dmenu -i -p'
TOPICS_FILE="${HOME}/.local/share/cht/choices"

# --- read topics ---
if [ ! -f "$TOPICS_FILE" ]; then
  echo "Topic file not found: $TOPICS_FILE"
  exit 1
fi
mapfile -t topics < "$TOPICS_FILE"

# --- select topic ---
topic=$(printf '%s\n' "${topics[@]}" | $ROFI 'cht.sh')
[ -z "$topic" ] && exit 0

# --- select query ---
query=$($ROFI "query for $topic")
[ -z "$query" ] && exit 0

# --- run terminal script ---
$TERMINAL -e sh -c "cht '$topic' '$query' | less -R"
