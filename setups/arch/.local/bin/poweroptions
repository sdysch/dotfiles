#!/usr/bin/env bash

PROMPT="$HOME/.local/bin/prompt"
LOGOUTSCRIPT="$HOME/.local/bin/logout-session"

use_rofi=false
if [[ ${1:-} == '-r' ]]; then
    use_rofi=true
    shift
fi

if $use_rofi; then
    PROMPT_CMD=("$PROMPT" "-r")
    MENU_CMD=(rofi -dmenu -fn 'xos4 Terminus:size=12' -sb '#A3BE8C' -nb '#2E3440' -nf '#D8DEE9' -sf '#434C5E' -p 'Choose an option: ' -l 4 -i)
else
    PROMPT_CMD=("$PROMPT")
    MENU_CMD=(dmenu -fn 'xos4 Terminus:size=12' -sb '#A3BE8C' -nb '#2E3440' -nf '#D8DEE9' -sf '#434C5E' -p 'Choose an option: ' -l 4 -i)
fi

options=$(
    printf '%s\n' \
        'Shutdown?' \
        'Reboot?' \
        'Logout?' \
        'Quit menu'
)

chosen=$(printf '%s\n' "$options" | "${MENU_CMD[@]}")

case $chosen in
    'Shutdown?')
        "${PROMPT_CMD[@]}" 'Shutdown?' &&
        notify-send -i "$ICONSDIR/shutdown.png" -u critical 'Shutdown' 'Shutting down' &&
        sleep 3 &&
        shutdown -h now
        ;;
    'Reboot?')
        "${PROMPT_CMD[@]}" 'Reboot?' &&
        notify-send -i "$ICONSDIR/shutdown.png" -u critical 'Shutdown' 'Rebooting' &&
        sleep 3 &&
        shutdown -r now
        ;;
    'Logout?')
        "${PROMPT_CMD[@]}" 'Logout?' "$LOGOUTSCRIPT"
        ;;
    'Quit menu'|'')
        exit 0
        ;;
esac
