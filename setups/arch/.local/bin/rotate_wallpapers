#!/bin/bash
export HYPRLAND_INSTANCE_SIGNATURE=$(cat ~/.cache/hyprland_sig)

# HYPRCTL=/usr/bin/hyprctl
# JQ=/usr/bin/jq
# HPRP=/usr/bin/hyprpaper

HYPRCTL=hyprctl
JQ=jq
HPRP=hyprpaper

WALLPAPERS_DIR="$HOME/dotfiles/wallpapers"
WALLPAPERS=("$WALLPAPERS_DIR"/*)

# Pick one at random
RANDOM_WALLPAPER="${WALLPAPERS[RANDOM % ${#WALLPAPERS[@]}]}"
echo $RANDOM_WALLPAPER >> /tmp/hyprpaper_wallpaper

# start hyprpaperif not running
pgrep hyprpaper > /dev/null || ($HPRP & disown; sleep 0.2)

# Apply to all monitors
for MON in $($HYPRCTL monitors -j | $JQ -r '.[].name'); do
    $HYPRCTL $HPRP wallpaper "$MON,$RANDOM_WALLPAPER"
done
