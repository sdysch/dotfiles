#!/bin/bash

NUM_HEADLINES=5

# Get unread count
unread=$(newsboat -x print-unread | awk '{print $1}')

# Get latest headlines
headlines=$(newsboat -x print-unread | head -n "$NUM_HEADLINES" | awk '{$1=""; print substr($0,2)}' | sed 's/"/\\"/g' | paste -sd '\\n' -)

# Print one-line JSON
if [ "$unread" -gt 0 ]; then
    printf '{"text":"ðŸ“° %s","tooltip":"%s"}' "$unread" "$headlines"
else
    printf '{"text":"ðŸ“° 0","tooltip":"No unread articles"}'
fi
